import{_ as e,a as t,b as i,c as n,d as r,e as o,f as s,g as a,h as l,i as p,j as u,k as c}from"./_rollupPluginBabelHelpers-e1425fd3.js";import h,{Children as v,isValidElement as d,cloneElement as f,Component as m}from"react";import{A as y,a as g,r as w,b as k,M as b,P as C}from"./pop-daf75174.js";var x=function(n){e(E,m);var u,c,h,b,C,x,A,L=t(E);function E(e){var t;for(var i in r(this,E),(t=L.call(this,e)).hover=!1,t.hasFocus=!1,t.inView=!1,t.scrollDelta=0,t.viewportMargin=e.viewportMargin,t.elements=[],t.animations={default:t.toAnimation(t.props.animate)},t.props.animations)t.animations[i]=t.toAnimation(t.props.animations[i]);return t.level=0,t.children=[],t}return i(E,[{key:"toAnimation",value:function(e){return!e||"object"!==o(e)&&"function"!=typeof e?null:"use"in e?e.use():new y(s(s({},e),{},{scaleCorrection:this.props.scaleCorrection}),this.props.initial)}},{key:"countNestedLevels",value:function(e){var t=this;if(!e)return 0;var i=0,n=0;return v.forEach(e,(function(e){var r;if(d(e)){e.type===E&&(i=1);var o=t.countNestedLevels(null===(r=e.props)||void 0===r?void 0:r.children);n=n<o?o:n}})),n+i}},{key:"componentDidMount",value:function(){var e=this;this.elements.forEach((function(t){var i;null===(i=e.animations.default)||void 0===i||i.setInitialStyles(t)})),(this.props.parentLevel<1||this.props.noCascade)&&(this.scrollEventListener=this.onScroll.bind(this),g("scroll",this.scrollEventListener),this.props.onMount&&this.play(this.props.onMount,{staggerDelay:.001,immediate:!0}),this.props.whileViewport&&this.onScroll())}},{key:"componentWillUnmount",value:function(){w("scroll",this.scrollEventListener),this.props.onUnmount&&(this.props.parentLevel<1||this.props.noCascade)&&this.play(this.props.onUnmount,{reverse:!0,immediate:!0})}},{key:"inViewport",value:function(){var e=this,t=!0,i=!0;return this.elements.forEach((function(n){var r=n.getBoundingClientRect().y;t=t&&r+n.clientHeight*(1-e.viewportMargin)<window.innerHeight,i=i&&r>window.innerHeight+n.clientHeight*e.viewportMargin})),this.elements.length||this.children.forEach((function(e){var n=e.animatable.inViewport(),r=a(n,2),o=r[0],s=r[1];t=t&&o,i=i&&s})),[t,i]}},{key:"onScroll",value:(A=l(p().mark((function e(){var t,i,n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Date.now()-this.scrollDelta<350)){e.next=2;break}return e.abrupt("return");case 2:this.scrollDelta=Date.now(),t=this.inViewport(),i=a(t,2),n=i[0],r=i[1],!this.inView&&n&&(this.inView=!0,this.props.whileViewport&&this.play(this.props.whileViewport)),this.inView&&r&&(this.inView=!1,this.props.whileViewport&&this.play(this.props.whileViewport,{reverse:!0,immediate:!0}));case 6:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"onEnter",value:(x=l(p().mark((function e(t){var i,n=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.length>1&&void 0!==n[1]&&n[1],this.hover||(this.props.whileHover&&this.play(this.props.whileHover),this.hover=!0),i&&i(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"onLeave",value:(C=l(p().mark((function e(t){var i,n=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.length>1&&void 0!==n[1]&&n[1],this.hover&&(this.props.whileHover&&this.play(this.props.whileHover,{reverse:!0}),this.hover=!1),i&&i(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"onFocus",value:(b=l(p().mark((function e(t){var i,n=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.length>1&&void 0!==n[1]&&n[1],this.hasFocus||(this.props.whileFocus&&this.play(this.props.whileFocus),this.hasFocus=!0),i&&i(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"onBlur",value:(h=l(p().mark((function e(t){var i,n=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.length>1&&void 0!==n[1]&&n[1],this.hasFocus&&(this.props.whileFocus&&this.play(this.props.whileFocus,{reverse:!0}),this.hasFocus=!1),i&&i(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"onClick",value:(c=l(p().mark((function e(t){var i,n=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.length>1&&void 0!==n[1]&&n[1],this.props.onClick&&this.play(this.props.onClick),i&&i(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"play",value:(u=l(p().mark((function e(t){var i,n,r,o,s,a,l,u,c,h,v,d,f,m,y,g,w=this,b=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=b.length>1&&void 0!==b[1]?b[1]:{},n=i.callback,r=i.reverse,o=void 0!==r&&r,s=i.immediate,a=void 0!==s&&s,l=i.cascade,u=void 0!==l&&l,c=i.groupAdjust,h=void 0===c?0:c,v=i.cascadeDelay,d=void 0===v?0:v,f=i.staggerDelay,m=void 0===f?0:f,!(this.props.parentLevel>0)||u){e.next=3;break}return e.abrupt("return");case 3:if(y="string"==typeof t?this.animations[t]:this.animations.default){e.next=6;break}return e.abrupt("return");case 6:g=0,this.elements.forEach((function(e,t){var i="group"in w.props?w.props.parentLevel-w.props.group:w.level+h;d=o?y.duration:d;var n=o?i*d:(w.props.parentLevel-i)*d;n=w.props.stagger*t+n+m,g=n>g?n:g,y.play(e,{delay:n,reverse:o,immediate:a})})),this.children.forEach((function(e){var i=e.animatable,n=e.staggerIndex,r=void 0===n?-1:n;null==i||i.play(t,{reverse:o,immediate:a,cascade:!0,staggerDelay:r<0?0:w.props.stagger*r,cascadeDelay:y.duration,groupAdjust:r<0?0:1})})),n&&k.delay(n,g+y.duration);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"style",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s(s({},e),{},{transitionProperty:"transform, opacity, clip-path, border-radius, background-color, color, width, height, left, top",willChange:"transform"});return t}},{key:"mergeProperties",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=s(s({},t),e);for(var n in i)["children","parentLevel","ref"].includes(n)?delete i[n]:"object"===o(e[n])&&"object"===o(t[n])&&(i[n]=s(s({},t[n]),e[n]));return i}},{key:"deepClone",value:function(e){var t,i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.index,o=void 0===r?0:r,a=n.useElements,l=void 0!==a&&a,p=n.useEvents,u=void 0!==p&&p;if(!d(e))return e;var c,h={};e.type!==E&&(l&&(h={style:this.style(null===(c=e.props)||void 0===c?void 0:c.style),ref:function(e){return i.elements[o]=e}}),u&&(this.props.parentLevel<1||this.props.noCascade)&&(h=s(s({},h),{},{onMouseEnter:function(t){var n;return i.onEnter(t,null===(n=e.props)||void 0===n?void 0:n.onMouseEnter)},onMouseLeave:function(t){var n;return i.onLeave(t,null===(n=e.props)||void 0===n?void 0:n.onMouseLeave)},onFocus:function(t){var n;return i.onFocus(t,null===(n=e.props)||void 0===n?void 0:n.onFocus)},onBlur:function(t){var n;return i.onBlur(t,null===(n=e.props)||void 0===n?void 0:n.onBlur)},onClick:function(t){var n;return i.onClick(t,null===(n=e.props)||void 0===n?void 0:n.onClick)}}),u=!1));e.type!==E||null!==(t=e.props)&&void 0!==t&&t.noCascade||(h=s(s(s({},h),this.mergeProperties(e.props,this.props)),{},{parentLevel:this.parentLevel>0?this.parentLevel:this.level,ref:function(e){return i.children[i.children.length]={animatable:e,staggerIndex:l?o:-1}}}));var m=v.map(e.props.children,(function(e,t){return i.deepClone(e,{index:t,useEvents:u})}));return Object.values(h).length?f(e,h,m):e}},{key:"render",value:function(){var e=this;return this.level=this.countNestedLevels(this.props.children),v.map(this.props.children,(function(t,i){return e.deepClone(t,{index:i,useElements:!0,useEvents:!0})}))}}]),E}();n(x,"defaultProps",{scaleCorrection:!1,parentLevel:0,stagger:.1,viewportMargin:.25,animate:{},animations:{}});var A=["levels","animations"],L=function(n){e(a,m);var o=t(a);function a(e){var t;return r(this,a),(t=o.call(this,e)).levels=t.props.levels,t.animations=new Array(t.levels).fill(0).map((function(e,i){return i<t.props.animations.length?t.props.animations[i]:t.props.animations[t.props.animations.length-1]})),t}return i(a,[{key:"makeAnimatable",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(i<1||v.count(e)<1)return e;var n=this.props;n.levels,n.animations;var r=u(n,A),o=this.animations[this.levels-i];return i===this.levels&&(r.ref=function(e){return t.animatable=e}),h.createElement(x,c({animate:o,scaleCorrection:o.scaleCorrection},r),v.map(e,(function(e){return d(e)?f(e,{},t.makeAnimatable(e.props.children,i-1)):e})))}},{key:"play",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null===(t=this.animatable)||void 0===t||t.play(e,s(s({},i),{},{reverse:!0}))}},{key:"render",value:function(){return this.makeAnimatable(this.props.children,this.levels)}}]),a}();n(L,"defaultProps",{levels:1,stagger:.1,viewportMargin:.25,animations:[b,C]});var E=function(n){e(s,x);var o=t(s);function s(e){var t;return r(this,s),(t=o.call(this,e)).animations.morphs=[],t}return i(s,[{key:"componentDidMount",value:function(){var e=this,t=this.elements[0];t&&(y.setInitial(t),t.setAttribute("uitools-morph-id",this.props.id),t.setAttribute("uitools-morph-active",this.props.active),this.self=t,this.createResetAnimation(),k.delay((function(){for(var i=document.querySelectorAll('[uitools-morph-id="'.concat(e.props.id,'"]')),n=0;n<i.length;n++)i[n]!==t&&(e.createMorphAnimation(i[n],n),"true"!==i[n].getAttribute("uitools-morph-active")&&e.animations.transition.setInitialStyles(i[n]))}),.001))}},{key:"componentDidUpdate",value:function(){var e=this,t="true"===this.self.getAttribute("uitools-morph-active");this.self.setAttribute("uitools-morph-active",this.props.active),k.delay((function(){if(e.props.active&&!t)e.animations.transition.setInitialStyles(e.self),e.animations.transition.play(e.self);else if(!e.props.active&&t){for(var i=0,n=document.querySelectorAll('[uitools-morph-id="'.concat(e.props.id,'"]')),r=0;r<n.length;r++)if(n[r]!==e.self&&"true"===n[r].getAttribute("uitools-morph-active")){i=r;break}e.animations.morphs[i].play(e.self)}}),.001)}},{key:"createResetAnimation",value:function(){var e,t=null===(e=this.self.UITools)||void 0===e?void 0:e.initialStyles;this.animations.transition=new y({opacity:[0,0,1],scale:{x:1,y:1},position:{x:0,y:0},borderRadius:t.borderRadius,backgroundColor:[t.backgroundColor,t.backgroundColor,t.backgroundColor],scaleCorrection:this.scaleCorrection},{})}},{key:"createMorphAnimation",value:function(e,t){var i,n,r=null===(i=this.self.UITools)||void 0===i?void 0:i.initialStyles,o=null===(n=e.UITools)||void 0===n?void 0:n.initialStyles;this.animations.morphs[t]=new y({position:[{x:0,y:0},{x:o.x-r.x+(o.clientWidth-r.clientWidth)/2,y:o.y-r.y+(o.clientHeight-r.clientHeight)/2},{x:o.x-r.x+(o.clientWidth-r.clientWidth)/2,y:o.y-r.y+(o.clientHeight-r.clientHeight)/2}],scale:[{x:1,y:1},{x:o.clientWidth/r.clientWidth,y:o.clientHeight/r.clientHeight},{x:o.clientWidth/r.clientWidth,y:o.clientHeight/r.clientHeight}],opacity:[1,1,0],borderRadius:[r.borderRadius,o.borderRadius,o.borderRadius],backgroundColor:[r.backgroundColor,o.backgroundColor,o.backgroundColor],scaleCorrection:this.scaleCorrection},{})}}]),s}();n(E,"defaultProps",{id:0,active:!1,scaleCorrection:!1});export{x as Animatable,L as Animate,E as Morph};
