import e from"@babel/runtime/helpers/asyncToGenerator";import t from"@babel/runtime/helpers/slicedToArray";import i from"@babel/runtime/helpers/toConsumableArray";import n from"@babel/runtime/helpers/typeof";import a from"@babel/runtime/helpers/objectWithoutProperties";import r from"@babel/runtime/helpers/classCallCheck";import o from"@babel/runtime/helpers/createClass";import s from"@babel/runtime/helpers/defineProperty";import l from"@babel/runtime/regenerator";var c=function(){function t(){r(this,t),this.queue=[],this.tick()}var i;return o(t,[{key:"uuid",value:function(){return Math.floor(1e6*Math.random()).toString(16).padStart("0",6)}},{key:"tick",value:(i=e(l.mark((function e(){var t,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Date.now(),i=0;case 2:if(!(i<this.queue.length+1)){e.next=10;break}if(!(this.queue.length===i||this.queue[i].timestamp>t)){e.next=6;break}return this.queue.splice(0,i),e.abrupt("break",10);case 6:this.queue[i].callback();case 7:i++,e.next=2;break;case 10:requestAnimationFrame(this.tick.bind(this));case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"search",value:function(e){for(var t,i,n=0,a=this.queue.length-1;n<=a;)if(t=n+a>>>1,(i=this.queue[t].timestamp-e.timestamp)<0)n=t+1;else{if(!(i>0))return t;a=t-1}return n}},{key:"insert",value:function(e){var t=this.search(e);this.queue.splice(t,0,e)}},{key:"cancel",value:function(e){var t=this.search(e);this.queue[t].id===e.id&&this.queue.splice(t,1),delete e.cancel}},{key:"delay",value:function(e,t){var i=this;if(e instanceof Function){var n=this.uuid(),a=Date.now()+1e3*t,r={timestamp:a,id:n,cancel:function(){return i.cancel(r)}};return this.insert({callback:function(){delete r.cancel,e()},timestamp:a,id:n}),r}}}],[{key:"get",value:function(){return"Lively"in window||(window.Lively={}),"AnimationLoop"in window.Lively||(window.Lively.AnimationQueue=new t),window.Lively.AnimationQueue}},{key:"delay",value:function(e,t){return this.get().delay(e,t)}},{key:"sleep",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(i){e.delay(i,t)}))}}]),t}(),u=function(e){var i=e.match(/^#([\da-f]{1,2})([\da-f]{1,2})([\da-f]{1,2})([\da-f]{2})?/i),n=t(i,5);n[0];var a=n[1],r=n[2],o=n[3],s=n[4];return{r:parseInt(a.padStart(2,a),16),g:parseInt(r.padStart(2,r),16),b:parseInt(o.padStart(2,o),16),a:void 0!==s?parseInt(s,16):255}},d=function(e){var i=e.match(/^rgba?\((\d+)\D+(\d+)\D+(\d+)\D*(\d+)?\)/i),n=t(i,5);n[0];var a=n[1],r=n[2],o=n[3],s=n[4];return{r:parseInt(a),g:parseInt(r),b:parseInt(o),a:void 0!==s?parseInt(s):255}},v=function(e,t){var i;if(t instanceof Function){null!==(i=window.Lively)&&void 0!==i&&i.Events||(window.Lively={Events:{}}),e in window.Lively.Events||(window.Lively.Events[e]={unique:0},window.addEventListener(e,(function(t){Object.values(window.Lively.Events[e]).forEach((function(e){e instanceof Function&&e(t)}))})));var n=window.Lively.Events[e];t.Lively={ListenerID:n.unique},n[n.unique++]=t}},y=function(e,t){var i,n;"undefined"!=typeof window&&null!==(i=window.Lively)&&void 0!==i&&null!==(n=i.Events)&&void 0!==n&&n[e]&&null!=t&&t.Lively&&"ListenerID"in t.Lively&&delete window.Lively.Events[e][t.Lively.ListenerID]},h=function(e,t){for(var i in e.style={},t)e.style[i]=t[i]},f=function(e){"Lively"in e||(e.Lively={queue:[],initials:{}}),e.Lively.style||(e.Lively.style=function(e){for(var t={},i=0;i<e.style.length;i++)t[e.style[i]]=e.style[e.style[i]];return t}(e),e.Lively.style.transitionProperty="transform, opacity, clip-path, border-radius, font-size, background-color, color, width, height, padding",e.Lively.style.willChange="transform"),h(e,e.Lively.style);var t=getComputedStyle(e),i=t.paddingLeft,n=t.paddingRight,a=t.paddingTop,r=t.paddingBottom,o=t.backgroundColor,s=t.color,l=t.borderRadius,c=t.padding,u=t.fontSize,d=e.getBoundingClientRect(),v=d.x,y=d.y;e.Lively.initials={x:v,y:y,paddingLeft:i,paddingRight:n,paddingTop:a,paddingBottom:r,backgroundColor:o,color:s,fontSize:u,width:e.offsetWidth+"px",height:e.offsetHeight+"px",borderRadius:l.split(" ")[0],padding:c.split(" ")[0]}},p=["delay","duration","repeat","interpolate","origin","useLayout"],g=function(){function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.delay,i=void 0===t?0:t,n=e.duration,o=void 0===n?1:n,l=e.repeat,c=void 0===l?1:l,u=e.interpolate,d=void 0===u?"ease":u,v=e.origin,y=void 0===v?{x:.5,y:.5}:v,h=e.useLayout,f=void 0!==h&&h,g=a(e,p),m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,s),this.useLayout=f,this.keyframes=this.getKeyframes(g,m),this.delay=i,this.duration=o,this.delta=o/(this.keyframes.length-1),this.interpolation="spring"===d?"cubic-bezier(0.65, 0.34, 0.7, 1.42)":d,this.origin=this.originToStyle(y),this.repeat=c}var v;return o(s,[{key:"originToStyle",value:function(e){var t=.5,i=.5;if("object"===n(e))t=e.x,i=e.y;else if("string"==typeof e)switch(e){case"left":t=0;break;case"right":t=1;break;case"top":i=0;break;case"bottom":i=1}else t=i=e;return"".concat(100*t,"% ").concat(100*i,"%")}},{key:"getKeyframes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0,r=function(r){var o=r in n?n[r]:s.initials[r];Array.isArray(e[r])||(e[r]=[e[r]]),e[r]=e[r].length>1?e[r]:[o].concat(i(e[r])),e[r]=e[r].map((function(e){return t.sanitize(r,e)})),a=e[r].length>a?e[r].length:a};for(var o in e)r(o);return new Array(a).fill(0).map((function(i,n){var r={};for(var o in e)o in s.initials&&(r[o]=t.interpolateKeyframe(e[o],n,a));return t.keyframeToStyle(r)}))}},{key:"sanitize",value:function(e,t){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof t){if(t.match(/^#[0-9a-f]{3,8}$/i))return u(t);if(t.match(/^rgba?\(.*\)$/i))return d(t);var r=parseFloat(t),o=(t.match(/[^0-9\.]*$/i)||["px"])[0];return isNaN(r)?s.initials[e]:("%"===o&&(r/=100),o?[r,o]:r)}if("object"===n(t)){var l=Object.keys(t),c=t;("x"in t||"y"in t)&&(l=["x","y"]),("r"in t||"g"in t||"b"in t||"a"in t)&&(l=["r","g","b","a"]),("left"in t||"right"in t||"top"in t||"bottom"in t)&&(l=["left","right","top","bottom"]),t={},l.forEach((function(n){t[n]=i.sanitize(e,c[n],n)}))}return void 0!==t?t:a?s.initials[e][a]:s.initials[e]}},{key:"interpolate",value:function(e,t,i){if("number"!=typeof e||"number"!=typeof t)return i>.5?t:e;var n=!1;Array.isArray(e)&&(n=e[1],e=e[0]),Array.isArray(t)&&(n=t[1],t=t[0]);var a=e*(1-i)+t*i;return n?[a,n]:a}},{key:"interpolateKeyframe",value:function(e,t,i){var a=this;if(e.length===i)return e[t];var r=t*((e.length-1)/(i-1)),o=Math.floor(r),s=e[o];if(o===e.length-1)return s;var l=e[o+1];if("object"===n(s)){var c={};return Object.keys(s).forEach((function(e){c[e]=a.interpolate(s[e],l[e],r-o)})),c}return this.interpolate(s,l,r-o)}},{key:"toString",value:function(e,t){return Array.isArray(e)&&(t=e[1],e=e[0]),e*("%"===t?100:1)+t}},{key:"toLength",value:function(e){return Array.isArray(e)&&(e="px"===e[1]?e[0]+"px":e[0]),e}},{key:"keyframeToStyle",value:function(e){var i=this,n={transform:""};return Object.entries(e).forEach((function(e){var a=t(e,2),r=a[0],o=a[1];switch(r){case"position":n.transform+="translate(".concat(i.toString(o.x,"px"),", ").concat(i.toString(o.y,"px"),") ");break;case"scale":if("number"==typeof o&&(o={x:o,y:o}),i.useLayout){n.width=i.toLength(o.x),n.height=i.toLength(o.y);break}n.transform+="scale(".concat(i.toString(o.x,"%"),", ").concat(i.toString(o.y,"%"),") ");break;case"rotation":n.transform+="rotate(".concat(i.toString(o,"deg"),") ");break;case"clip":n.clipPath="inset(".concat(i.toString(o.top,"%")," ").concat(i.toString(o.right,"%")," ").concat(i.toString(o.bottom,"%")," ").concat(i.toString(o.left,"%"),")");break;case"borderRadius":case"padding":case"fontSize":n[r]=i.toString(o,"px");break;case"backgroundColor":case"color":n[r]="rgba(".concat(o.r,", ").concat(o.g,", ").concat(o.b,", ").concat(o.a,")");break;case"interact":n.pointerEvents=o?"all":"none";break;case"opacity":case"active":n[r]=o}})),n.transform.length||delete n.transform,n}},{key:"setInitial",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.keyframes[0];e.style.transitionDuration="0s",e.style.transitionTimingFunction=this.interpolation,e.style.transformOrigin=this.origin,this.apply(e,t,!0)}},{key:"setToLast",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(n||null!==(t=e.Lively)&&void 0!==t&&t.keyframe)&&this.setInitial(e,null===(i=e.Lively)||void 0===i?void 0:i.keyframe)}},{key:"setLength",value:function(e,t,i,n,a){var r=e.Lively.initials[i],o=parseInt(e.Lively.initials[n]),s=parseInt(e.Lively.initials[a]),l=t[i],c=t.padding?1:o/(0===s?1e-6:s);"string"==typeof l&&(l="calc(".concat(l," / ").concat(r,")"));var u=t.padding?t.padding:o+s+"px";e.style[i]="max(calc(".concat(r," * ").concat(l," - ").concat("border-box"!==e.style.boxSizing?"0px":u,"), 0px)");var d="calc(min(calc(".concat(r," * ").concat(l,"), ").concat(u,") * ");e.style[n]=d+.5*c,e.style[a]=d+1/c*.5}},{key:"apply",value:(v=e(l.mark((function e(i,n){var a,r,o=this,s=arguments;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>2&&void 0!==s[2]&&s[2],!("active"in n)){e.next=11;break}if("start"!==(r=Object.keys(n.active)[0])&&!a){e.next=10;break}if(i.style.display=n.active[r]?"":"none",a){e.next=8;break}return e.next=8,c.sleep(.001);case 8:e.next=11;break;case 10:c.delay((function(){i.style.display=n.active[r]?"":"none"}),this.delta);case 11:Object.entries(n).forEach((function(e){var a=t(e,2),r=a[0],s=a[1];return"width"===r?o.setLength(i,n,"width","paddingLeft","paddingRight"):"height"===r?o.setLength(i,n,"height","paddingTop","paddingBottom"):void("active"===r||"padding"===r&&(n.width||n.height)||(i.style[r]=s))})),i.Lively.keyframe=n;case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"start",value:function(e){var t,i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.immediate,r=void 0!==a&&a,o=n.reverse,s=void 0!==o&&o,l=n.repeat,c=void 0===l?this.repeat:l;!e.Lively.animating||r?(this.setInitial(e),e.style.transitionDuration="".concat(this.delta,"s"),e.Lively.index=1,e.Lively.animating=!0,null!==(t=e.Lively.next)&&void 0!==t&&t.cancel&&e.Lively.next.cancel(),requestAnimationFrame((function(){return i.getNext(e,s,c)}))):e.Lively.queue.push([this,{reverse:s,repeat:c}])}},{key:"play",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.delay,a=void 0===n?0:n,r=i.immediate,o=void 0!==r&&r,s=i.reverse,l=void 0!==s&&s;e.style&&(this.delay||a?e.next=c.delay((function(){return t.start(e,{immediate:o,reverse:l})}),this.delay+a):this.start(e,{immediate:o,reverse:l}))}},{key:"getNext",value:function(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.Lively.index===this.keyframes.length){e.Lively.animating=!1;var r=e.Lively.queue.shift()||[],o=t(r,2),s=o[0],l=o[1];return s?s.start(e,l):void(a>1&&this.start(e,{reverse:n,repeat:a-1}))}var u=e.Lively.index;n&&(u=this.keyframes.length-1-u),this.apply(e,this.keyframes[u]),e.Lively.index++,e.Lively.next=c.delay((function(){return i.getNext(e,n,a)}),this.delta)}}]),s}();s(g,"initials",{opacity:1,scale:{x:1,y:1},position:{x:0,y:0},rotation:0,clip:{left:0,top:0,right:0,bottom:0},borderRadius:0,padding:0,fontSize:"1rem",backgroundColor:{r:127,g:127,b:127,a:255},color:{r:127,g:127,b:127,a:255},active:{start:!0},interact:!0});export{c as A,g as a,v as b,f as c,y as r,h as s};
