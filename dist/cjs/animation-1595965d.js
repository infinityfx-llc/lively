"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),t=require("@babel/runtime/helpers/objectWithoutProperties"),i=require("@babel/runtime/helpers/classCallCheck"),n=require("@babel/runtime/helpers/createClass"),r=require("@babel/runtime/helpers/defineProperty"),a=require("@babel/runtime/helpers/asyncToGenerator"),o=require("@babel/runtime/regenerator"),s=require("@babel/runtime/helpers/typeof");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=l(e),c=l(t),d=l(i),h=l(n),y=l(r),f=l(a),v=l(o),p=l(s),g=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;"Lively"in i||(i.Lively={}),e in i.Lively||(i.Lively[e]=t)},m=function(e){return e&&"object"===p.default(e)&&!Array.isArray(e)},b=function(e){var t=e.match(/^#([\da-f]{1,2})([\da-f]{1,2})([\da-f]{1,2})([\da-f]{2})?/i),i=u.default(t,5);i[0];var n=i[1],r=i[2],a=i[3],o=i[4];return{r:parseInt(n.padStart(2,n),16),g:parseInt(r.padStart(2,r),16),b:parseInt(a.padStart(2,a),16),a:void 0!==o?parseInt(o,16):255}},k=function(e){var t=e.match(/^rgba?\((\d+)\D+(\d+)\D+(\d+)\D*(\d+)?\)/i),i=u.default(t,5);i[0];var n=i[1],r=i[2],a=i[3],o=i[4];return{r:parseInt(n),g:parseInt(r),b:parseInt(a),a:void 0!==o?parseInt(o):255}},L=function(){function e(){d.default(this,e),this.queue=[],this.tick()}var t;return h.default(e,[{key:"uuid",value:function(){return Math.floor(1e6*Math.random()).toString(16).padStart("0",6)}},{key:"tick",value:(t=f.default(v.default.mark((function e(){var t,i,n;return v.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Date.now(),i=0;case 2:if(!(i<this.queue.length+1)){e.next=13;break}if(n=this.queue[i],!(this.queue.length===i||n.timestamp>t)){e.next=7;break}return this.queue.splice(0,i),e.abrupt("break",13);case 7:n.callback(),delete n.cancel,delete n.store[n.id+n.timestamp];case 10:i++,e.next=2;break;case 13:requestAnimationFrame(this.tick.bind(this));case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"search",value:function(e){for(var t,i,n=0,r=this.queue.length-1;n<=r;)if(t=n+r>>>1,(i=this.queue[t].timestamp-e.timestamp)<0)n=t+1;else{if(!(i>0))return t;r=t-1}return n}},{key:"insert",value:function(e){var t=this.search(e);this.queue.splice(t,0,e)}},{key:"cancel",value:function(e){for(var t=this.search(e);t>0&&this.queue[t].timestamp>=e.timestamp;)t--;for(;t<this.queue.length&&this.queue[t].timestamp<=e.timestamp;){if(this.queue[t].id===e.id){this.queue.splice(t,1);break}t++}delete e.cancel}},{key:"delay",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e instanceof Function){var r={timestamp:Date.now()+1e3*t,id:this.uuid(),cancel:function(){return i.cancel(r)},callback:e,store:n};return this.insert(r),n[r.id+r.timestamp]=r,r}}}],[{key:"get",value:function(){return g("AnimationQueue",new e),window.Lively.AnimationQueue}},{key:"cancelAll",value:function(e){for(var t in e)e[t].cancel(),delete e[t]}},{key:"delay",value:function(e,t,i){return this.get().delay(e,t,i)}},{key:"sleep",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(i){e.delay(i,t)}))}}]),e}(),x=["delay","duration","repeat","interpolate","origin","useLayout"];function w(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.delay,n=void 0===i?0:i,r=t.duration,a=void 0===r?1:r,o=t.repeat,s=void 0===o?1:o,l=t.interpolate,u=void 0===l?"ease":l,h=t.origin,y=void 0===h?{x:.5,y:.5}:h,f=t.useLayout,v=void 0!==f&&f,p=c.default(t,x),g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.default(this,e),this.length=0,this.useLayout=v,this.keyframes=this.getKeyframes(p,g),this.delay=n,this.duration=a,this.delta=a/(this.length-1),this.interpolation="spring"===u?"cubic-bezier(0.65, 0.34, 0.7, 1.42)":u,this.origin=this.originToStyle(y),this.repeat=s}return h.default(e,[{key:"originToStyle",value:function(e){var t=.5,i=.5;if(m(e))t=e.x,i=e.y;else if("string"==typeof e)switch(e){case"left":t=0;break;case"right":t=1;break;case"top":i=0;break;case"bottom":i=1}else t=i=e;return"".concat(100*t,"% ").concat(100*i,"%")}},{key:"getKeyframes",value:function(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(r){var a=r in n?n[r]:e.initials[r];Array.isArray(t[r])||(t[r]=[t[r]]),t[r].length<2&&t[r].unshift(a),t[r]=t[r].map((function(e){return i.sanitize(r,e)})),i.length=Math.max(t[r].length,i.length)};for(var a in t)r(a);return new Array(this.length).fill(0).map((function(n,r){var a={start:{},end:{}};for(var o in t)if(o in e.initials){var s=i.interpolateKeyframe(t[o],r,i.length);m(s)&&("start"in s||"end"in s||"set"in s)?("start"in s&&(a.start[o]=s.start),"end"in s&&(a.end[o]=s.end),"set"in s&&(a[o]=s.set)):a[o]=s}return i.keyframeToStyle(a)}))}},{key:"sanitize",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof i){if(i.match(/^#[0-9a-f]{3,8}$/i))return b(i);if(i.match(/^rgba?\(.*\)$/i))return k(i);var r=parseFloat(i),a=(i.match(/[^0-9\.]*$/i)||["px"])[0];return isNaN(r)?e.initials[t]:("%"===a&&(r/=100),a?[r,a]:r)}if(m(i)){var o=Object.keys(i),s=i;("x"in i||"y"in i)&&(o=["x","y"]),("r"in i||"g"in i||"b"in i||"a"in i)&&(o=["r","g","b","a"]),("left"in i||"right"in i||"top"in i||"bottom"in i)&&(o=["left","right","top","bottom"]),i={};var l,u=w(o);try{for(u.s();!(l=u.n()).done;){var c=l.value;i[c]=this.sanitize(t,s[c],c)}}catch(e){u.e(e)}finally{u.f()}}if(void 0!==i)return i;var d=e.initials[t];return n in d?d[n]:d}},{key:"interpolate",value:function(e,t,i){if(m(e)){for(var n={},r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];n[o]=this.interpolate(e[o],m(t)?t[o]:t,i)}return n}var s=!1;if(Array.isArray(e)&&(s=e[1],e=e[0]),Array.isArray(t)&&(s=t[1],t=t[0]),"number"!=typeof e||"number"!=typeof t)return i>.5?t:e;var l=e*(1-i)+t*i;return s?[l,s]:l}},{key:"interpolateKeyframe",value:function(e,t,i){if(e.length===i)return e[t];var n=t*((e.length-1)/(i-1)),r=Math.floor(n),a=e[r];return r===e.length-1?a:this.interpolate(a,e[r+1],n-r)}},{key:"toString",value:function(e,t){return Array.isArray(e)&&(t=e[1],e=e[0]),e*("%"===t?100:1)+t}},{key:"toLength",value:function(e){return Array.isArray(e)&&(e="px"===e[1]?e[0]+"px":e[0]),e}},{key:"keyframeToStyle",value:function(e){for(var t={transform:""},i=0,n=Object.entries(e);i<n.length;i++){var r=u.default(n[i],2),a=r[0],o=r[1];switch(a){case"start":case"end":Object.keys(o).length&&(t[a]=this.keyframeToStyle(o));break;case"position":t.transform+="translate(".concat(this.toString(o.x,"px"),", ").concat(this.toString(o.y,"px"),") ");break;case"scale":if("number"==typeof o&&(o={x:o,y:o}),this.useLayout){t.width=this.toLength(o.x),t.height=this.toLength(o.y);break}t.transform+="scale(".concat(this.toString(o.x,"%"),", ").concat(this.toString(o.y,"%"),") ");break;case"rotation":t.transform+="rotate(".concat(this.toString(o,"deg"),") ");break;case"clip":t.clipPath="inset(".concat(this.toString(o.top,"%")," ").concat(this.toString(o.right,"%")," ").concat(this.toString(o.bottom,"%")," ").concat(this.toString(o.left,"%"),")"),t.webkitClipPath=t.clipPath;break;case"borderRadius":case"padding":case"fontSize":t[a]=this.toString(o,"px");break;case"backgroundColor":case"color":t[a]="rgba(".concat(o.r,", ").concat(o.g,", ").concat(o.b,", ").concat(o.a,")");break;case"interact":t.pointerEvents=o?"all":"none";break;case"opacity":case"active":case"zIndex":t[a]=o}}return t.transform.length||delete t.transform,t}},{key:"setLength",value:function(e,t,i,n,r){var a=e.Lively.initials[i],o=parseInt(e.Lively.initials[n]),s=parseInt(e.Lively.initials[r]),l=t[i],u=t.padding?1:o/(0===s?1e-6:s);"string"==typeof l&&(l="calc(".concat(l," / ").concat(a,")"));var c=t.padding?t.padding:o+s+"px";e.style[i]="max(calc(".concat(a," * ").concat(l," - ").concat("border-box"!==e.style.boxSizing?"0px":c,"), 0px)");var d="calc(min(calc(".concat(a," * ").concat(l,"), ").concat(c,") * ");e.style[n]=d+.5*u,e.style[r]=d+1/(0===u?1e-6:u)*.5}},{key:"apply",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,a=void 0===r?this.delta:r,o=n.reverse,s=void 0!==o&&o,l=function(){e.style.transitionDuration="".concat(a,"s");for(var n=0,r=Object.entries(t);n<r.length;n++){var o=u.default(r[n],2),s=o[0],l=o[1];"width"!==s?"height"!==s?"padding"===s&&(t.width||t.height)||"start"===s||"end"===s||(e.style[s]=l):i.setLength(e,t,"height","paddingTop","paddingBottom"):i.setLength(e,t,"width","paddingLeft","paddingRight")}e.Lively.keyframe=t};"start"in t&&!s||"end"in t&&s?(this.apply(e,t[s?"end":"start"],{duration:0}),L.delay(l,.001)):l(),("end"in t&&!s||"start"in t&&s)&&L.delay(this.apply.bind(this,e,t[s?"start":"end"],{duration:0}),this.delta,e.Lively.timeouts)}},{key:"setInitial",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.keyframes[0];e.style.transitionTimingFunction=this.interpolation,e.style.transformOrigin=this.origin,this.apply(e,t,{duration:0})}},{key:"setToLast",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(n||null!==(t=e.Lively)&&void 0!==t&&t.keyframe)&&this.setInitial(e,null===(i=e.Lively)||void 0===i?void 0:i.keyframe)}},{key:"start",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.immediate,r=void 0!==n&&n,a=i.reverse,o=void 0!==a&&a,s=i.repeat,l=void 0===s?this.repeat:s;!e.Lively.animating||r?(this.setInitial(e,o?this.keyframes[this.length-1]:this.keyframes[0]),e.Lively.index=1,e.Lively.animating=!0,requestAnimationFrame((function(){return t.getNext(e,o,l)}))):e.Lively.queue.push([this,{reverse:o,repeat:l}])}},{key:"play",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.delay,n=void 0===i?0:i,r=t.immediate,a=void 0!==r&&r,o=t.reverse,s=void 0!==o&&o;if(e.style&&this.length){a&&(e.Lively.queue=[],L.cancelAll(e.Lively.timeouts));var l=this.start.bind(this,e,{immediate:a,reverse:s});this.delay||n?L.delay(l,this.delay+n,e.Lively.timeouts):l()}}},{key:"getNext",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.Lively.index===this.length){e.Lively.animating=!1;var r=e.Lively.queue.shift()||[],a=u.default(r,2),o=a[0],s=a[1];return o?o.start(e,s):void(n>1&&this.start(e,{reverse:i,repeat:n-1}))}var l=e.Lively.index;i&&(l=this.length-1-l),this.apply(e,this.keyframes[l],{reverse:i}),e.Lively.index++,L.delay((function(){return t.getNext(e,i,n)}),this.delta,e.Lively.timeouts)}}]),e}();y.default(q,"initials",{opacity:1,scale:{x:1,y:1},position:{x:0,y:0},rotation:0,clip:{left:0,top:0,right:0,bottom:0},borderRadius:0,padding:0,fontSize:"1rem",backgroundColor:{r:127,g:127,b:127,a:255},color:{r:127,g:127,b:127,a:255},active:!0,interact:!0,zIndex:0}),exports.Animation=q,exports.AnimationQueue=L,exports.addEventListener=function(e,t){if(t instanceof Function){g("Events",{}),e in window.Lively.Events||(window.Lively.Events[e]={unique:0},window.addEventListener(e,(function(t){Object.values(window.Lively.Events[e]).forEach((function(e){e instanceof Function&&e(t)}))})));var i=window.Lively.Events[e];t.Lively={ListenerID:i.unique},i[i.unique++]=t}},exports.cacheElementStyles=function(e){g("queue",[],e),g("timeouts",{},e),e.Lively.style||(e.Lively.style=function(e){for(var t={},i=0;i<e.style.length;i++)t[e.style[i]]=e.style[e.style[i]];return t}(e),e.Lively.style.transitionProperty="transform, opacity, clip-path, border-radius, font-size, background-color, color, width, height, padding",e.Lively.style.willChange="transform"),function(e,t){for(var i in e.style={},t)e.style[i]=t[i]}(e,e.Lively.style);var t=getComputedStyle(e),i=t.paddingLeft,n=t.paddingRight,r=t.paddingTop,a=t.paddingBottom,o=t.backgroundColor,s=t.color,l=t.borderRadius,u=t.padding,c=t.fontSize,d=t.zIndex,h=e.getBoundingClientRect(),y=h.x,f=h.y,v=h.width,p=h.height;e.Lively.initials={x:y,y:f,paddingLeft:i,paddingRight:n,paddingTop:r,paddingBottom:a,backgroundColor:o,color:s,fontSize:c,zIndex:"auto"===d?0:parseInt(d),width:v+"px",height:p+"px",borderRadius:l.split(" ")[0],padding:u.split(" ")[0]}},exports.isObject=m,exports.livelyProperty=g,exports.padArray=function(e,t){return new Array(t).fill(0).map((function(t,i){return i<e.length?e[i]:e[e.length-1]}))},exports.removeEventListener=function(e,t){var i,n;"undefined"!=typeof window&&null!==(i=window.Lively)&&void 0!==i&&null!==(n=i.Events)&&void 0!==n&&n[e]&&null!=t&&t.Lively&&"ListenerID"in t.Lively&&delete window.Lively.Events[e][t.Lively.ListenerID]};
