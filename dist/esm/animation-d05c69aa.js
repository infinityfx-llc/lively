import t from"@babel/runtime/helpers/slicedToArray";import e from"@babel/runtime/helpers/objectWithoutProperties";import i from"@babel/runtime/helpers/classCallCheck";import n from"@babel/runtime/helpers/createClass";import{i as r,l as a}from"./helper-ef605e17.js";import o from"@babel/runtime/helpers/asyncToGenerator";import s from"@babel/runtime/regenerator";var u={opacity:1,scale:{x:1,y:1},position:{x:0,y:0},rotation:0,clip:{left:0,top:0,right:0,bottom:0},borderRadius:0,padding:0,fontSize:"1rem",backgroundColor:{r:127,g:127,b:127,a:255},color:{r:127,g:127,b:127,a:255},active:!0,interact:!0,zIndex:0,strokeLength:1},l=["opacity","active","zIndex","lineHeight","fontWeight"];function c(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var f=function(e){var i=e.match(/^#([\da-f]{1,2})([\da-f]{1,2})([\da-f]{1,2})([\da-f]{2})?/i),n=t(i,5);n[0];var r=n[1],a=n[2],o=n[3],s=n[4];return{r:parseInt(r.padStart(2,r),16),g:parseInt(a.padStart(2,a),16),b:parseInt(o.padStart(2,o),16),a:void 0!==s?parseInt(s,16):255}},d=function(e){var i=e.match(/^rgba?\((\d+)\D+(\d+)\D+(\d+)\D*(\d+)?\)/i),n=t(i,5);n[0];var r=n[1],a=n[2],o=n[3],s=n[4];return{r:parseInt(r),g:parseInt(a),b:parseInt(o),a:void 0!==s?parseInt(s):255}},v=function(t){var e=.5,i=.5;if(r(t))e=t.x,i=t.y;else if("string"==typeof t)switch(t){case"left":e=0;break;case"right":e=1;break;case"top":i=0;break;case"bottom":i=1}else e=i=t;return"".concat(100*e,"% ").concat(100*i,"%")},y=function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof i){if(i.match(/^#[0-9a-f]{3,8}$/i))return f(i);if(i.match(/^rgba?\(.*\)$/i))return d(i);var a=(i.match(/[^0-9\.]*$/i)||["px"])[0];return i=parseFloat(i),isNaN(i)?u[e]:("%"===a&&(i/=100),a?[i,a]:i)}if(r(i)){var o=Object.keys(i),s=i;("x"in i||"y"in i)&&(o=["x","y"]),("r"in i||"g"in i||"b"in i||"a"in i)&&(o=["r","g","b","a"]),("left"in i||"right"in i||"top"in i||"bottom"in i)&&(o=["left","right","top","bottom"]),i={};var l,h=c(o);try{for(h.s();!(l=h.n()).done;){var v=l.value;i[v]=t(e,s[v],v)}}catch(t){h.e(t)}finally{h.f()}}if(void 0!==i)return i;var y=u[e];return n in y?y[n]:y},p=function(t,e){return Array.isArray(t)&&(e=t[1],t=t[0]),t*("%"===e?100:1)+e},m=function(t){return Array.isArray(t)&&(t="px"===t[1]?t[0]+"px":t[0]),t},g=function t(e,i,n){if(r(e)){var a={};for(var o in e)a[o]=t(e[o],r(i)?i[o]:i,n);return a}var s;if(Array.isArray(e)&&(s=e[1],e=e[0]),Array.isArray(i)&&(s=i[1],i=i[0]),"number"!=typeof e||"number"!=typeof i)return n>.5?i:e;var u=e*(1-n)+i*n;return s?[u,s]:u},b=function(t,e,i){if(t.length===i)return t[e];var n=e*((t.length-1)/(i-1)),r=Math.floor(n);return r===t.length-1?t[r]:g(t[r],t[r+1],n-r)},k=function(){function t(){i(this,t),this.queue=[],this.tick()}var e;return n(t,[{key:"uuid",value:function(){return Math.floor(1e6*Math.random()).toString(16).padStart("0",6)}},{key:"tick",value:(e=o(s.mark((function t(){var e,i,n;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Date.now(),i=0;case 2:if(!(i<this.queue.length+1)){t.next=13;break}if(n=this.queue[i],!(this.queue.length===i||n.timestamp>e)){t.next=7;break}return this.queue.splice(0,i),t.abrupt("break",13);case 7:n.callback(),delete n.cancel,delete n.store[n.id+n.timestamp];case 10:i++,t.next=2;break;case 13:requestAnimationFrame(this.tick.bind(this));case 14:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"search",value:function(t){for(var e,i,n=0,r=this.queue.length-1;n<=r;)if(e=n+r>>>1,(i=this.queue[e].timestamp-t.timestamp)<0)n=e+1;else{if(!(i>0))return e;r=e-1}return n}},{key:"insert",value:function(t){var e=this.search(t);this.queue.splice(e,0,t)}},{key:"cancel",value:function(t){for(var e=this.search(t);e>0&&this.queue[e].timestamp>=t.timestamp;)e--;for(;e<this.queue.length&&this.queue[e].timestamp<=t.timestamp;){if(this.queue[e].id===t.id){this.queue.splice(e,1);break}e++}delete t.cancel}},{key:"delay",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t instanceof Function){var r={timestamp:Date.now()+1e3*e,id:this.uuid(),cancel:function(){return i.cancel(r)},callback:t,store:n};return this.insert(r),n[r.id+r.timestamp]=r,r}}}],[{key:"get",value:function(){return a("AnimationQueue",new t),window.Lively.AnimationQueue}},{key:"cancelAll",value:function(t){for(var e in t)t[e].cancel(),delete t[e]}},{key:"delay",value:function(t,e,i){return this.get().delay(t,e,i)}},{key:"sleep",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(i){t.delay(i,e)}))}}]),t}(),x=["duration","interpolate","origin","useLayout"],L=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,a=void 0===r?0:r,o=n.interpolate,s=void 0===o?"ease":o,u=n.origin,l=void 0===u?{x:.5,y:.5}:u,c=n.useLayout,h=void 0!==c&&c,f=e(n,x);i(this,t),this.style=f,this.start={},this.end={},this.duration=a,this.interpolate="spring"===s?"cubic-bezier(0.65, 0.34, 0.7, 1.42)":s,this.origin=v(l),this.useLayout=h}return n(t,[{key:"addProperty",value:function(t,e){if(!r(e)||!("start"in e||"end"in e||"set"in e))return this.style[t]=e;"start"in e&&(this.start[t]=e.start),"end"in e&&(this.end[t]=e.end),"set"in e&&(this.style[t]=e.set)}},{key:"compile",value:function(){return this.style=this.interpret(this.style),this.start=this.interpret(this.start),this.end=this.interpret(this.end),this}},{key:"interpret",value:function(t){if(!Object.keys(t).length)return null;var e={transform:""};for(var i in t){var n=t[i];if(n instanceof Function){if(null===(n=n()))continue;n=y(i,n)}switch(i){case"position":e.transform+="translate(".concat(p(n.x,"px"),", ").concat(p(n.y,"px"),") ");break;case"scale":if("number"==typeof n&&(n={x:n,y:n}),this.useLayout){e.width=m(n.x),e.height=m(n.y);break}e.transform+="scale(".concat(p(n.x,"%"),", ").concat(p(n.y,"%"),") ");break;case"rotation":e.transform+="rotate(".concat(p(n,"deg"),") ");break;case"clip":e.clipPath="inset(".concat(p(n.top,"%")," ").concat(p(n.right,"%")," ").concat(p(n.bottom,"%")," ").concat(p(n.left,"%"),")"),e.webkitClipPath=e.clipPath;break;case"interact":e.pointerEvents=n?"":"none";break;case"active":e.display=n?"":"none";break;case"strokeLength":e.strokeDashoffset=1-n;break;default:r(n)&&"r"in n?e[i]="rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(n.a,")"):l.includes(i)?e[i]=n:e[i]=p(n,"px")}}return e}},{key:"initial",value:function(t){t.style.transitionTimingFunction=this.interpolate,t.style.transformOrigin=this.origin,this.apply(t,{duration:0})}},{key:"apply",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.duration,r=void 0===n?this.duration:n,a=i.reverse,o=void 0!==a&&a,s=t.setStyle.bind(t,e,this.style,r);this[o?"end":"start"]?(t.setStyle(e,this[o?"end":"start"],0),k.delay(s,.001)):s(),this[o?"start":"end"]&&k.delay(t.setStyle.bind(t,e,this[o?"start":"end"],0),r,e.Lively.timeouts)}},{key:"update",value:function(e){e.style.transitionTimingFunction=this.interpolate,e.style.transformOrigin=this.origin;var i=this.interpret(this.style);t.setStyle(e,i,this.duration)}}],[{key:"setStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(var n in t.style.transitionDuration="".concat(i,"s"),e)"width"!==n?"height"!==n?"padding"===n&&(e.width||e.height)||"start"===n||"end"===n||(t.style[n]=e[n]):this.setLength(t,e,"height","paddingTop","paddingBottom"):this.setLength(t,e,"width","paddingLeft","paddingRight")}},{key:"setLength",value:function(t,e,i,n,r){var a=t.Lively.initials[i],o=parseInt(t.Lively.initials[n]),s=parseInt(t.Lively.initials[r]),u=e[i],l=e.padding?1:o/(0===s?1e-6:s);"string"==typeof u&&(u="calc(".concat(u," / ").concat(a,")"));var c=e.padding?e.padding:o+s+"px";t.style[i]="max(calc(".concat(a," * ").concat(u," - ").concat("border-box"!==t.style.boxSizing?"0px":c,"), 0px)");var h="calc(min(calc(".concat(a," * ").concat(u,"), ").concat(c,") * ");t.style[n]=h+.5*l,t.style[r]=h+1/(0===l?1e-6:l)*.5}}]),t}(),A=["delay","duration","repeat","alternate"],w=["interpolate","origin","useLayout"],q=function(){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.delay,a=void 0===n?0:n,o=t.duration,s=void 0===o?1:o,u=t.repeat,l=void 0===u?1:u,c=t.alternate,h=void 0!==c&&c,f=e(t,A),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,r),this.length=0,this.delay=a,this.duration=s,this.repeat=l,this.alternate=h,this.keyframes=this.parse(f,d)}return n(r,[{key:"initial",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.keyframes[0];e&&e.initial(t)}},{key:"restore",value:function(t){var e,i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(n||null!==(e=t.Lively)&&void 0!==e&&e.keyframe)&&this.initial(t,null===(i=t.Lively)||void 0===i?void 0:i.keyframe)}},{key:"parse",value:function(t,i){var n=this,r=t.interpolate,a=t.origin,o=t.useLayout,s=e(t,w),l=function(t){Array.isArray(s[t])||(s[t]=[s[t]]),s[t].length<2&&s[t].unshift(t in i?i[t]:u[t]),s[t]=s[t].map((function(e){return y(t,e)})),n.length=Math.max(s[t].length,n.length)};for(var c in s)l(c);return new Array(this.length).fill(0).map((function(t,e){var i=new L({interpolate:r,origin:a,useLayout:o,duration:n.duration/(n.length-1)});for(var u in s)i.addProperty(u,b(s[u],e,n.length));return i.compile()}))}},{key:"start",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.immediate,r=void 0!==n&&n,a=i.reverse,o=void 0!==a&&a,s=i.repeat,u=void 0===s?this.repeat:s;!t.Lively.animating||r?(this.initial(t,o?this.keyframes[this.length-1]:this.keyframes[0]),t.Lively.index=1,t.Lively.animating=!0,requestAnimationFrame((function(){return e.getNext(t,o,u)}))):t.Lively.queue.push([this,{reverse:o,repeat:u}])}},{key:"play",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.delay,n=void 0===i?0:i,r=e.immediate,a=void 0!==r&&r,o=e.reverse,s=void 0!==o&&o;if(t.style&&this.length){a&&(t.Lively.queue=[],k.cancelAll(t.Lively.timeouts));var u=this.start.bind(this,t,{immediate:a,reverse:s});this.delay||n?k.delay(u,this.delay+n,t.Lively.timeouts):u()}}},{key:"getNext",value:function(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.Lively.index===this.length){e.Lively.animating=!1;var a=e.Lively.queue.shift()||[],o=t(a,2),s=o[0],u=o[1];return s?s.start(e,u):void(r>1&&this.start(e,{reverse:this.alternate?!n:n,repeat:r-1}))}var l=e.Lively.index;n&&(l=this.length-1-l),this.keyframes[l].apply(e,{reverse:n}),e.Lively.keyframe=this.keyframes[l],e.Lively.index++,k.delay((function(){return i.getNext(e,n,r)}),this.duration/(this.length-1),e.Lively.timeouts)}}]),r}(),S={create:function(e){var i=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.use=t.use.bind(t,e),t};return i.use=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e(i),r=t(n,2),a=r[0],o=r[1];return new q(a,o)},i},isAnimation:function(t){return t instanceof Function&&"use"in t}};export{k as A,L as K,q as a,S as b};
